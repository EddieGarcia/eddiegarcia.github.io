<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Calculator</title>
    <meta name="description" content="Calculator">
    <meta name="author" content="eg">
    <!--<link rel="stylesheet" href="css/styles.css?v=1.0">-->
</head>

<body>
    <form>
        <label for="vyskaHypo">Vyska hypoteky:</label><br>
        <input type="text" id="vyskaHypo" name="vyskaHypo"><br>
        <label for="dobaSplacania">Doba splacania:</label><br>
        <input type="text" id="dobaSplacania" name="dobaSplacania">
        <h3>Uroky v obdobiach</h3>
        <label for="obd1Poc">------ Obdobie 1 ------</label><br>
        <label for="obd1Poc">Pocet rokov:</label><br>
        <input type="text" id="obd1Poc" name="obd1Poc"><br>
        <label for="obd1Urok">Urok:</label><br>
        <input type="text" id="obd1Urok" name="obd1Urok"><br>

        <label for="obd2Poc">------ Obdobie 2 ------</label><br>
        <label for="obd2Poc">Pocet rokov:</label><br>
        <input type="text" id="obd2Poc" name="obd2Poc"><br>
        <label for="obd1Urok">Urok:</label><br>
        <input type="text" id="obd2Urok" name="obd2Urok"><br>

        <label for="obd3Poc">------ Obdobie 3 ------</label><br>
        <label for="obd3Poc">Pocet rokov:</label><br>
        <input type="text" id="obd3Poc" name="obd3Poc"><br>
        <label for="obd3Urok">Urok:</label><br>
        <input type="text" id="obd3Urok" name="obd3Urok"><br>
    </form>

    <div id="error" style="color: red"></div>
    <button onclick="calculate()">Vypocitaj</button>

    <div id="result">
        <div id="table"></div>
        <div id="urok"></div>
    </div>

    <script>
        function calculate() {
            const dobaSplatnosti = parseFloat(document.getElementById('dobaSplacania').value);
            const vyskaHypo = parseFloat(document.getElementById('vyskaHypo').value);
        
            const obd1Poc = parseFloat(document.getElementById('obd1Poc').value) || 0;
            const obd1Urok = parseFloat(document.getElementById('obd1Urok').value) || 0;
        
            const obd2Poc = parseFloat(document.getElementById('obd2Poc').value) || 0;
            const obd2Urok = parseFloat(document.getElementById('obd2Urok').value) || 0;
        
            const obd3Poc = parseFloat(document.getElementById('obd3Poc').value) || 0;
            const obd3Urok = parseFloat(document.getElementById('obd3Urok').value) || 0;
        
            const errorDiv = document.getElementById("error");
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = "";
            if (!dobaSplatnosti || !vyskaHypo || !obd1Poc || !obd1Urok) {
                errorDiv.innerHTML = "Polia doba splatnosti, vyska hypo a 1. obdobie musia byt vyplnene"
                return;
            }
            else if (obd1Poc + obd2Poc + obd3Poc !== dobaSplatnosti) {
                errorDiv.innerHTML = "Sucet obdobi sa musi rovnat dobe splatnosti"
                return;
            }
            else {
                errorDiv.innerHTML = "";
            }
        
            // Vypocet hypoteky
            const pocetMesiacovSplacania = dobaSplatnosti * 12;
            const mesacnyUrokObd1 = obd1Urok / 12 / 100;
            const pocetMesiacovObd1 = dobaSplatnosti * 12;

            const mesacnyUrokObd2 = obd2Urok / 12 / 100;
            const pocetMesiacovObd2 = (obd2Poc + obd3Poc) * 12;

            const mesacnyUrokObd3 = obd3Urok / 12 / 100;
            const pocetMesiacovObd3 = obd3Poc * 12;
            
        
            let zaplatenyUrok = 0;
            let vyskaNaZaciatkuMesiaca = vyskaHypo;
            let discountFactor = getDiscountFactor(mesacnyUrokObd1, pocetMesiacovObd1);
            let mesacnyUrok = mesacnyUrokObd1;
            let vyskaSplatky = vyskaHypo / discountFactor;
            let farba = 'red'
            let tabulka = '';
            for (let i = 1; i <= pocetMesiacovSplacania; i++) {
                // Prepocitanie splatky 
                if (i === obd1Poc * 12 + 1) {
                    discountFactor = getDiscountFactor(mesacnyUrokObd2, pocetMesiacovObd2);
                    vyskaSplatky = vyskaNaZaciatkuMesiaca / discountFactor;
                    let mesacnyUrok = mesacnyUrokObd2;
                    farba = 'blue';
                }
                else if (i === ((obd1Poc + obd2Poc) * 12) + 1) {
                    discountFactor = getDiscountFactor(mesacnyUrokObd3, pocetMesiacovObd3);
                    let mesacnyUrok = mesacnyUrokObd3;
                    vyskaSplatky = vyskaNaZaciatkuMesiaca / discountFactor;
                    farba = 'green';
                }

                const vyskaSplatenehoUroku = vyskaNaZaciatkuMesiaca * mesacnyUrok;
                const vyskaSplatenejIstiny = vyskaSplatky - vyskaSplatenehoUroku;
                zaplatenyUrok = zaplatenyUrok + vyskaSplatenehoUroku;
                 tabulka += `<tr style='backgroundcolor: ${farba}'><td>${i}</td><td>${vyskaNaZaciatkuMesiaca.toFixed(2)}</td><td>${vyskaSplatenehoUroku.toFixed(2)}</td><td>${vyskaSplatenejIstiny.toFixed(2)}</td><td>${zaplatenyUrok.toFixed(2)}</td></tr>`;
                vyskaNaZaciatkuMesiaca = vyskaNaZaciatkuMesiaca - vyskaSplatenejIstiny;
            }
        
            document.getElementById("table").innerHTML = `<table><tr>
                <th>Mesiac</th>
                <th>Vyska na zac mesiaca</th>
                <th>Vyska splateneho uroku</th>
                <th>Vyska splatenej istiny</th>
                <th>Zaplateny urok</th>
            </tr> ${tabulka}</table>`;
            document.getElementById("urok").innerHTML = `<h2>Zaplateny urok ${zaplatenyUrok}</h2>`;
        }
        
        function getDiscountFactor(mesacnyUrok, pocetMesiacovSplacania){
            // discount factor ({[(1+.005)^360] - 1} / [.005(1+.005)^360])
            return ((Math.pow(1 + mesacnyUrok, pocetMesiacovSplacania) - 1) / (mesacnyUrok * Math.pow(1 + mesacnyUrok, pocetMesiacovSplacania)));
        }
    </script>
</body>
</html>